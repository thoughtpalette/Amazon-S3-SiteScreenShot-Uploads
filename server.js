var express = require( "express" );
var http    = require( "http" );
var bodyParser = require('body-parser');
var app     = express();
var webshot = require('webshot');
var cors = require('express-cors');
var AWS = require('aws-sdk');
var Readable = require('stream').Readable;
var fs = require('fs');
AWS.config.loadFromPath('./aws-config.json');

app.use(cors({
    allowedOrigins: [
        'localhost:3000'
    ],
    headers: [
        'Access-Control-Allow-Credentials','x-xsrf-token', 'Content-Type'
    ]
}));

app.use(bodyParser.json());
app.use(bodyParser.urlencoded({
  extended: true
}));

app.post( "/screenshot", function ( req, res ) {

    var css = '@charset "UTF-8"; .ncmsEditable {position: relative; z-index: 1; } .ncmsEditable:focus, .ncmsEditable.active {outline: none; background: transparent; } .ncmsEditable, .ncmsEditable:hover {pointer-events: auto; } .ncmsEditable:focus, .ncmsEditable:hover:focus {color: inherit; outline: none; background: transparent; } .ncmsEditable br, .ncmsEditable:hover br {display: none; } .ncmsEditable *, .ncmsEditable:hover * {display: inline; } .ncmsEditable:hover {color: #328358; } .ncmsEditable:hover:after, .ncmsEditable:focus:after {position: absolute; top: -10px; right: -10px; bottom: -10px; left: -10px; z-index: -1; content: " "; background: #90e1b6; border-radius: 10px; cursor: pointer; } .ncmsEditable-active {color: inherit; outline: none; background: transparent; } .ncmsEditable-active:hover, .ncmsEditable-active:focus {background: transparent; color: inherit; } .ncmsEditable-active:after {content: " "; position: absolute; top: -10px; right: -10px; bottom: -10px; left: -10px; z-index: 1; background: transparent; border: 1px solid #4bd88d; border-radius: 10px; } .ncmsEditable-active:focus:after {color: inherit; background: transparent; } .ncmsEditable-active:hover {background: transparent; color: inherit; } .ncmsEditable_parent {pointer-events: none; } .ncms_flex-row {box-sizing: border-box; display: -webkit-box; display: -webkit-flex; display: -ms-flexbox; display: flex; -webkit-box-flex: 0; -webkit-flex: 0 1 auto; -ms-flex: 0 1 auto; flex: 0 1 auto; -webkit-box-orient: horizontal; -webkit-box-direction: normal; -webkit-flex-direction: row; -ms-flex-direction: row; flex-direction: row; -webkit-flex-wrap: wrap; -ms-flex-wrap: wrap; flex-wrap: wrap; } .ncms_flex-col {box-sizing: border-box; display: -webkit-box; display: -webkit-flex; display: -ms-flexbox; display: flex; -webkit-box-flex: 0; -webkit-flex: 0 1 auto; -ms-flex: 0 1 auto; flex: 0 1 auto; -webkit-box-orient: vertical; -webkit-box-direction: normal; -webkit-flex-direction: column; -ms-flex-direction: column; flex-direction: column; -webkit-flex-wrap: wrap; -ms-flex-wrap: wrap; flex-wrap: wrap; } .ncms_flex-center-abs {-webkit-box-align: center; -webkit-align-items: center; -ms-flex-align: center; align-items: center; -webkit-box-pack: center; -webkit-justify-content: center; -ms-flex-pack: center; justify-content: center; } .ncms_svg {width: 100%; shape-rendering: auto; } .ncms p:not(.ncms_caption) {font-family: "Karla" , sans-serif; font-size: 0.875rem; font-weight: 400; letter-spacing: 0.05em; color: #fff; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; margin: 0; } .ncms h1, .ncms h2 {white-space: nowrap; } .ncms h1 {font-family: "Karla" , sans-serif; font-size: 1.125rem; font-weight: 700; line-height: 1.5em; color: #96aaaf; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; } .ncms h2 {font-family: "Montserrat" , sans-serif; font-size: 0.625rem; font-weight: 400; line-height: 1.25em; letter-spacing: 0.1175em; text-transform: uppercase; color: #96aaaf; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; } .ncms button {border: 0; outline: none; } .ncms input:focus {outline: none; } .ncms_caption {font-family: "Montserrat" , sans-serif; font-size: 0.625rem; font-weight: 400; line-height: 1.6em; letter-spacing: 0.0625em; color: #96aaaf; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; margin: 0; } .ncms_type-bold {font-weight: 700; } .ncms_type-live {color: #00c569; } .ncms_nowrap {-webkit-flex-wrap: nowrap; -ms-flex-wrap: nowrap; flex-wrap: nowrap; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } @-webkit-keyframes ncms_fade-in {0% {opacity: 0; } 100% {opacity: 1; } } @keyframes ncms_fade-in {0% {opacity: 0; } 100% {opacity: 1; } } @-webkit-keyframes ncms_fade-out {0% {opacity: 1; } 100% {opacity: 0; } } @keyframes ncms_fade-out {0% {opacity: 1; } 100% {opacity: 0; } } @-webkit-keyframes ncms_bounce {0%, 20%, 50%, 80%, 100% {-webkit-transform: translateY(0); transform: translateY(0); } 40% {-webkit-transform: translateY(-0.5rem); transform: translateY(-0.5rem); } 60% {-webkit-transform: translateY(-0.25rem); transform: translateY(-0.25rem); } } @keyframes ncms_bounce {0%, 20%, 50%, 80%, 100% {-webkit-transform: translateY(0); transform: translateY(0); } 40% {-webkit-transform: translateY(-0.5rem); transform: translateY(-0.5rem); } 60% {-webkit-transform: translateY(-0.25rem); transform: translateY(-0.25rem); } } @-webkit-keyframes ncms_bounce-reverse {0%, 20%, 50%, 80%, 100% {-webkit-transform: translateY(0); transform: translateY(0); } 40% {-webkit-transform: translateY(0.5rem); transform: translateY(0.5rem); } 60% {-webkit-transform: translateY(0.25rem); transform: translateY(0.25rem); } } @keyframes ncms_bounce-reverse {0%, 20%, 50%, 80%, 100% {-webkit-transform: translateY(0); transform: translateY(0); } 40% {-webkit-transform: translateY(0.5rem); transform: translateY(0.5rem); } 60% {-webkit-transform: translateY(0.25rem); transform: translateY(0.25rem); } } @-webkit-keyframes ncms_accordian-in-out {30%, 70% {max-height: 12.5rem; } 0%, 100% {max-height: 0; } } @keyframes ncms_accordian-in-out {30%, 70% {max-height: 12.5rem; } 0%, 100% {max-height: 0; } } .ncms {display: block; position: fixed; font-size: 0.8rem; bottom: 0; right: 0; z-index: 1000000; } .ncms_core {position: relative; margin-right: 2rem; margin-bottom: 2rem; z-index: 100; background-color: #454e51; border-radius: 0.8rem; overflow: hidden; -webkit-flex-wrap: nowrap; -ms-flex-wrap: nowrap; flex-wrap: nowrap; } #ncms_shade {display: block; position: absolute; width: 500rem; height: 500rem; bottom: 0; right: 0; background-color: #000; opacity: 0.5; } .ncms_input, input.ncms_input {font-family: "Karla" , sans-serif; font-size: 0.875rem; font-weight: 400; letter-spacing: 0.05em; color: #fff; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; width: 100%; color: #96aaaf; padding: 0.35rem 0.5rem; border-radius: 0.25rem; border: 0; background-color: #263033; -webkit-font-smoothing: subpixel-antialiased; } .ncms_input, input.ncms_input, .ncms_input:hover, input.ncms_input:hover, .ncms_input:focus, input.ncms_input:focus {-webkit-filter: none; filter: none; } .ncms_input::-webkit-input-placeholder, input.ncms_input::-webkit-input-placeholder {color: #59666b; } .ncms_input::-moz-placeholder, input.ncms_input::-moz-placeholder {color: #59666b; } .ncms_input:-ms-input-placeholder, input.ncms_input:-ms-input-placeholder {color: #59666b; } .ncms_input::placeholder, input.ncms_input::placeholder {color: #59666b; } .ncms_input::-webkit-inner-spin-button, input.ncms_input::-webkit-inner-spin-button, .ncms_input::-webkit-calendar-picker-indicator, input.ncms_input::-webkit-calendar-picker-indicator {display: none; } input.ncms_input:hover, input.ncms_input:focus {-webkit-filter: none; filter: none; } button {border: 0; } button:focus {outline: 0; } .ncms_button {font-family: "Karla" , sans-serif; font-size: 0.875rem; font-weight: 400; letter-spacing: 0.05em; color: #fff; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; border-radius: 0.25rem; background-color: #59666b; color: #fff; font-weight: 700; } .ncms_button > .ncms_svg {fill: #fff; } .ncms_button_icon {background-color: transparent; color: #96aaaf; } .ncms_button_icon > .ncms_svg {fill: #96aaaf; } .ncms_button, .ncms_button_icon {margin: 0; padding: 0; cursor: pointer; text-align: center; } .ncms_button-active, .ncms_button_icon-active, .ncms_button-active:hover, .ncms_button_icon-active:hover {color: #fff; } .ncms_button_icon-active > .ncms_svg, .ncms_button_icon-active:hover > .ncms_svg {fill: #fff; } .ncms_button-close {-webkit-transform: rotateZ(45deg); transform: rotateZ(45deg); } .ncms_button:hover {background-color: #96aaaf; } .ncms_button_icon:hover {color: #fff; } .ncms_button_icon:hover > .ncms_svg {fill: #fff; } .ncms_button:disabled {opacity: 0.5; color: #96aaaf; background-color: #59666b; } .ncms_button_icon:disabled {color: #96aaaf; } .ncms_button_icon:disabled > .ncms_svg {fill: #59666b; } .ncms_button:disabled:hover {opacity: 0.5; color: #96aaaf; background-color: #59666b; } .ncms_button_icon:disabled:hover {color: #96aaaf; } .ncms_button_icon:disabled:hover > .ncms_svg {fill: #59666b; } .ncms_button-create.ncms_button:hover:not(:disabled) {background-color: #00c569; } .ncms_button-create.ncms_button_icon:hover:not(:disabled) {color: #00c569; } .ncms_button-create.ncms_button_icon:hover:not(:disabled) > .ncms_svg {fill: #00c569; } .ncms_button-delete.ncms_button:hover:not(:disabled) {background-color: #f2512a; } .ncms_button-delete.ncms_button_icon:hover:not(:disabled) {color: #f2512a; fill: #f2512a; } .ncms_button-delete.ncms_button_icon:hover:not(:disabled) > .ncms_svg {fill: #f2512a; } .ncms_button-send.ncms_button:hover:not(:disabled) {background-color: #ffa700; } .ncms_button-send.ncms_button_icon:hover:not(:disabled) {color: #ffa700; } .ncms_button-send.ncms_button_icon:hover:not(:disabled) > .ncms_svg {fill: #ffa700; } .ncms_button-find.ncms_button:hover:not(:disabled) {background-color: #0cc3dc; } .ncms_button-find.ncms_button_icon:hover:not(:disabled) {color: #0cc3dc; } .ncms_button-find.ncms_button_icon:hover:not(:disabled) > .ncms_svg {fill: #0cc3dc; } .ncms_editor {width: 18.5rem; max-width: 0; height: 3.65rem; -webkit-transition-property: max-width, height; transition-property: max-width, height; -webkit-transition-duration: 0.5s; transition-duration: 0.5s; overflow: hidden; -webkit-box-pack: end; -webkit-justify-content: flex-end; -ms-flex-pack: end; justify-content: flex-end; -webkit-flex-wrap: nowrap; -ms-flex-wrap: nowrap; flex-wrap: nowrap; -webkit-box-flex: 1; -webkit-flex: 1; -ms-flex: 1; flex: 1; } .ncms_editor-open.ncms_editor {height: 25rem; max-width: 18.5rem; } .ncms_editor-open .ncms_menu_crux {border-top: 1px solid #59666b; } .ncms_editor-open .ncms_editor_head {height: 5.75rem; min-height: 5.75rem; } .ncms_editor-open .ncms_editor_toggle {padding: 1.375rem; -webkit-box-align: start; -webkit-align-items: flex-start; -ms-flex-align: start; align-items: flex-start; } .ncms_editor-open h1.ncms_editor_head_title {font-size: 1.125rem; color: #96aaaf; } .ncms_editor_head {height: 3.65rem; min-height: 3.65rem; -webkit-flex-wrap: nowrap; -ms-flex-wrap: nowrap; flex-wrap: nowrap; background-color: #454e51; } .ncms_editor_toggle {display: -webkit-box; display: -webkit-flex; display: -ms-flexbox; display: flex; width: 100%; height: 100%; padding: 0 1.375rem; -webkit-box-align: center; -webkit-align-items: center; -ms-flex-align: center; align-items: center; text-align: left; } .ncms_editor_toggle_item {-webkit-box-flex: 0; -webkit-flex: 0 1 auto; -ms-flex: 0 1 auto; flex: 0 1 auto; overflow: hidden; } .ncms_editor_toggle_item .ncms_caption {white-space: nowrap; } h1.ncms_editor_head_title {-webkit-box-flex: 0; -webkit-flex: 0 1 auto; -ms-flex: 0 1 auto; flex: 0 1 auto; font-size: 0.875rem; color: #fff; } .ncms_editor_head_close {padding-right: 1.375rem; padding-top: 1.375rem; } .ncms_editor_head_close > .ncms_button_icon {width: 1rem; -webkit-transform: rotate(45deg); -ms-transform: rotate(45deg); transform: rotate(45deg); } .ncms_editor > section {-webkit-box-flex: 0; -webkit-flex: 0 0 100%; -ms-flex: 0 0 100%; flex: 0 0 100%; -webkit-transition-property: margin; transition-property: margin; -webkit-transition-duration: 0.5s; transition-duration: 0.5s; -webkit-flex-wrap: nowrap; -ms-flex-wrap: nowrap; flex-wrap: nowrap; } .ncms-active > .ncms_core:hover > .ncms_editor {max-width: 18.5rem; } .ncms_editor_body, .ncms_editor_body-disable {-webkit-box-flex: 1; -webkit-flex: 1; -ms-flex: 1; flex: 1; -webkit-flex-wrap: nowrap; -ms-flex-wrap: nowrap; flex-wrap: nowrap; -webkit-animation-name: ncms_fade-in; animation-name: ncms_fade-in; -webkit-animation-duration: 0.3s; animation-duration: 0.3s; -webkit-animation-fill-mode: forwards; animation-fill-mode: forwards; background-color: #454e51; padding: 0 1.375rem; overflow-x: hidden; overflow-y: auto; -ms-overflow-style: none; } .ncms_editor_body::-webkit-scrollbar, .ncms_editor_body-disable::-webkit-scrollbar {display: none; } .ncms_editor_body-disable > .ncms_editor_body_group {-webkit-filter: opacity(0.5); filter: opacity(0.5); opacity: 0.5; } .ncms_editor_body_group {margin-bottom: 0.8125rem; -webkit-box-flex: 0; -webkit-flex: 0 0 auto; -ms-flex: 0 0 auto; flex: 0 0 auto; } .ncms_editor_body_group > h2 {margin-bottom: 0.5rem; } .ncms_editor_body_group:last-child {margin-bottom: 1.5rem; } .ncms_schedule-end-option {font-family: "Montserrat", sans-serif; font-size: 0.625rem; font-weight: 400; line-height: 1.25em; letter-spacing: 0.1175em; text-transform: uppercase; color: #96aaaf; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; } .ncms_schedule-end-option label {cursor: pointer; } .ncms_schedule-end-option input {display: inline-block; margin-right: 5px; } .ncms_schedule-end-option span {display: inline-block; } .ncms_editor_foot {height: 3.65rem; -webkit-box-flex: 0; -webkit-flex: 0 0 auto; -ms-flex: 0 0 auto; flex: 0 0 auto; } .ncms_editor_foot_button {display: -webkit-box; display: -webkit-flex; display: -ms-flexbox; display: flex; margin: 0.4rem 0 0.4rem 0.4rem; padding: 0.5rem; -webkit-box-flex: 1; -webkit-flex: 1; -ms-flex: 1; flex: 1; -webkit-box-pack: center; -webkit-justify-content: center; -ms-flex-pack: center; justify-content: center; -webkit-box-align: center; -webkit-align-items: center; -ms-flex-align: center; align-items: center; } .ncms_editor_foot_button:last-child {margin-right: 0.4rem; } .ncms_editor_foot_button > .ncms_svg {width: 1.25rem; margin-right: 0.25rem; } .ncms_menu {background-color: #263033; } .ncms_menu_nav {position: relative; -webkit-box-flex: 1; -webkit-flex: 1 0 auto; -ms-flex: 1 0 auto; flex: 1 0 auto; z-index: 1; } .ncms_menu_nav .ncms_button_icon {width: 3.65rem; height: 3.65rem; padding: 1rem; } .ncms_menu_nav-wrap {position: absolute; height: 100%; } .ncms_menu_nav-position {-webkit-box-flex: 1; -webkit-flex: 1 0 auto; -ms-flex: 1 0 auto; flex: 1 0 auto; } .ncms_menu_nav_item {position: relative; } .ncms_menu_nav_item_dot {display: -webkit-box; display: -webkit-flex; display: -ms-flexbox; display: flex; -webkit-box-align: center; -webkit-align-items: center; -ms-flex-align: center; align-items: center; -webkit-box-pack: center; -webkit-justify-content: center; -ms-flex-pack: center; justify-content: center; position: absolute; top: 0.25rem; right: 0.25rem; width: 1.5rem; height: 1.5rem; font-family: "Montserrat" , sans-serif; font-weight: 700; font-size: 0.6875rem; color: #fff; background-color: #ffa700; border-radius: 1rem; border: 0.25rem solid #263033; } .ncms_menu_crux {width: 3.65rem; height: 3.65rem; padding: 0.4rem; z-index: 2; background-color: #263033; } .ncms_menu_crux_edit {width: 100%; height: 100%; padding: 0; overflow: hidden; border-radius: 0.4rem; background-color: #454e51; } .ncms_menu_crux_edit > .ncms_menu_crux_edit_switch {-webkit-transform: translateX(35%); -ms-transform: translateX(35%); transform: translateX(35%); background-color: #f2512a; } .ncms_menu_crux_edit-on > .ncms_menu_crux_edit_switch {-webkit-transform: translateX(0); -ms-transform: translateX(0); transform: translateX(0); background-color: #00c569; } .ncms_menu_crux_edit_switch {position: relative; width: 75%; height: 100%; padding: 0.5rem; overflow: hidden; border-radius: 0.4rem; -webkit-transition: -webkit-transform 0.2s; transition: transform 0.2s; } .ncms_menu_crux_edit_switch > .ncms_svg {fill: #fff; } .ncms_menu_crux_edit_switch_wait {display: none; position: absolute; top: 0; right: 0; bottom: 0; left: 0; background-color: #ffa700; } .ncms_taglist, .ncms_list {margin: 0; padding: 0; list-style: none; overflow-x: hidden; overflow-y: auto; -ms-overflow-style: none; } .ncms_taglist::-webkit-scrollbar, .ncms_list::-webkit-scrollbar {display: none; } .ncms_taglist {-webkit-box-flex: 0; -webkit-flex: 0 0 auto; -ms-flex: 0 0 auto; flex: 0 0 auto; } .ncms_list {-webkit-box-flex: 1; -webkit-flex: 1; -ms-flex: 1; flex: 1; } .ncms_list_item {padding: 0.6875em 0; border-top: 1px solid #59666b; } .ncms_list_item:hover .ncms_list_item_type {color: #00c569; } .ncms_list_item > .ncms_button-delete {margin-left: 1rem; width: 1.25rem; opacity: 0; } .ncms_list_item > .ncms_button-delete > .ncms_svg {fill: #96aaaf; } .ncms_list_item:hover > .ncms_button-delete {opacity: 1; } .ncms_list_item_block {-webkit-box-flex: 1; -webkit-flex: 1; -ms-flex: 1; flex: 1; cursor: pointer; } .ncms_list_item_tag {-webkit-box-flex: 0; -webkit-flex: 0 0 auto; -ms-flex: 0 0 auto; flex: 0 0 auto; } .ncms_list_item_tag_info {font-family: "Karla" , sans-serif; font-size: 1.125rem; font-weight: 700; line-height: 1.5em; color: #96aaaf; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; margin-left: 1em; padding: 0.25em 0.5em; border-radius: 0.35rem; font-size: 0.5rem; letter-spacing: 0.1em; color: #fff; background-color: #00c569; vertical-align: middle; } .ncms_list_item_tag_info > .ncms_svg {width: 1rem; } .tag_red {background-color: #f2512a; } .ncms_taglist_item {font-family: "Karla" , sans-serif; font-size: 0.875rem; font-weight: 400; letter-spacing: 0.05em; color: #fff; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; margin-top: 0.5em; border: 0.15rem solid #263033; border-radius: 0.35rem; padding: 0.25rem 0.5rem; -webkit-box-align: center; -webkit-align-items: center; -ms-flex-align: center; align-items: center; -webkit-box-pack: justify; -webkit-justify-content: space-between; -ms-flex-pack: justify; justify-content: space-between; background-color: #59666b; cursor: pointer; } .ncms_taglist_item > .ncms_svg {-webkit-transform: rotate(45deg); -ms-transform: rotate(45deg); transform: rotate(45deg); width: 0.75em; fill: #263033; } .ncms_taglist_item_left.ng-binding {display: inline; padding: 0px; text-overflow: ellipsis; width: 200px; overflow: hidden; } .ncms_taglist_item_right {display: inline; padding: 1px; float: right; } .ncms_taglist_item_right.ncms_editor_head_close {padding: 1px; } .angucomplete-holder {background-color: #263033; color: #96aaaf; border-radius: 0.35rem; } .angucomplete-dropdown {padding: 0.25rem 0.5rem 0.5rem 0.5rem; cursor: pointer; background-color: transparent; } .angucomplete-row, .angucomplete-searching {font-family: "Karla" , sans-serif; font-size: 0.875rem; font-weight: 400; letter-spacing: 0.05em; color: #fff; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; color: #59666b; border-top: 1px solid #59666b; padding: 0.65rem 0 0.5rem 0; } .angucomplete-selected-row {color: #fff; } .angucomplete-image-holder {padding-top: 2px; float: left; margin-right: 10px; margin-left: 5px; } .angucomplete-image {height: 34px; width: 34px; border-radius: 50%; border-color: #ececec; border-style: solid; border-width: 1px; } .angucomplete-image-default {/* Add your own default image here background-image: url("/assets/default.png") */ background-position: center; background-size: contain; height: 34px; width: 34px; } .ncms_dropdown {background-color: #263033; border-radius: 0.25rem; cursor: pointer; } .ncms_dropdown_button {-webkit-flex-wrap: nowrap; -ms-flex-wrap: nowrap; flex-wrap: nowrap; -webkit-box-align: center; -webkit-align-items: center; -ms-flex-align: center; align-items: center; background-color: #263033; -webkit-font-smoothing: subpixel-antialiased; } .ncms_dropdown_button:after {content: ""; display: inline-block; width: 0; height: 0; border-left: 0.35rem solid transparent; border-right: 0.35rem solid transparent; border-top: 0.5rem solid #96aaaf; } .ncms_dropdown_label {height: 1rem; -webkit-box-flex: 1; -webkit-flex: 1; -ms-flex: 1; flex: 1; overflow: hidden; } .ncms_dropdown_list {margin-top: 0.25rem; padding: 0 0.5rem; } .ncms_dropdown_list_item {font-family: "Karla" , sans-serif; font-size: 0.875rem; font-weight: 400; letter-spacing: 0.05em; color: #fff; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; color: #59666b; } .ncms_dropdown_list_item:hover {color: #fff; } .ncms_alert {padding: 0 1.375rem; -webkit-box-flex: 0; -webkit-flex: 0 0 auto; -ms-flex: 0 0 auto; flex: 0 0 auto; overflow: hidden; } .ncms_alert > p.ncms_alert-wrap {-webkit-box-align: center; -webkit-align-items: center; -ms-flex-align: center; align-items: center; width: 100%; font-size: 0.625rem; letter-spacing: 0.065em; padding: 1em 0; } .ncms_alert-red, .ncms_alert-green {-webkit-animation-name: ncms_accordian-in-out; animation-name: ncms_accordian-in-out; -webkit-animation-direction: normal; animation-direction: normal; -webkit-animation-duration: 4s; animation-duration: 4s; -webkit-animation-delay: 0.2s; animation-delay: 0.2s; -webkit-animation-fill-mode: both; animation-fill-mode: both; -webkit-animation-timing-function: ease-in-out; animation-timing-function: ease-in-out; } .ncms_alert-red {background-color: #f2512a; } .ncms_alert-green {background-color: #00c569; } .ncms_action {margin-bottom: 2rem; -webkit-box-flex: 0; -webkit-flex: 0 0 auto; -ms-flex: 0 0 auto; flex: 0 0 auto; } .ncms_action_foot {-webkit-box-flex: 1; -webkit-flex: 1 0 auto; -ms-flex: 1 0 auto; flex: 1 0 auto; margin-top: 1.5rem; } .ncms_action_foot > .ncms_button {height: 2rem; display: -webkit-box; display: -webkit-flex; display: -ms-flexbox; display: flex; margin: 0; padding: 0 0.5rem; -webkit-box-flex: 1; -webkit-flex: 1; -ms-flex: 1; flex: 1; -webkit-box-pack: center; -webkit-justify-content: center; -ms-flex-pack: center; justify-content: center; -webkit-box-align: center; -webkit-align-items: center; -ms-flex-align: center; align-items: center; } .ncms_action_foot > .ncms_button:last-child {margin-left: 0.4rem; } #ncms-createPicture, #ncms-createNBSP {display: none; } #ncms_inline-editor {position: absolute; z-index: 20000; background: #454e51; color: #a6b8bc; border-radius: 5px; padding: 7px; box-sizing: border-box; } #ncms_inline-editor .ncms_menu {background: #454e51; border-radius: 10px; } #ncms_inline-editor .ncms-arrow-wrapper {position: relative; display: none; width: 100%; clear: both; } #ncms_inline-editor .ncms-arrow-wrapper.top {-webkit-transform: rotate(180deg); -ms-transform: rotate(180deg); transform: rotate(180deg); } #ncms_inline-editor .ncms-arrow-wrapper.top.open {display: block; } #ncms_inline-editor .ncms-arrow-wrapper.bottom.open {display: block; } #ncms_inline-editor .ncms-arrow-wrapper .editor-tooltip-arrow {position: relative; bottom: -6px; left: 0; display: block; background: #454e51; } #ncms_inline-editor .ncms-arrow-wrapper .editor-tooltip-arrow:after {top: 100%; left: 50%; border: solid transparent; content: " "; height: 0; width: 0; position: absolute; pointer-events: none; border-color: rgba(69,78,81,0); border-top-color: #454e51; border-width: 10px; margin-left: -10px; } #ncms_inline-editor #ncms-actions.close {display: none; } #ncms_inline-editor #ncms-actions h3 {font-family: "Montserrat", sans-serif; text-transform: uppercase; font-size: 10px; font-weight: normal; letter-spacing: 2px; margin: 0 0 10px 0; } #ncms_inline-editor #ncms-actions button {width: 160px; color: #fff; } #ncms_inline-editor #ncms-actions #ncms-addVariable svg, #ncms_inline-editor #ncms-actions #ncms-createLink svg {width: 14px; fill: #a6b8bc; background: transparent; vertical-align: middle; margin: -2px 10px 0 0; } #ncms_inline-editor #ncms-actions #ncms-addVariable:hover svg, #ncms_inline-editor #ncms-actions #ncms-createLink:hover svg {fill: #fff; } #ncms_inline-editor #ncms-variables {position: relative; } #ncms_inline-editor .ncms-close-editor {display: none; position: absolute; top: 0; right: 0; width: 20px; height: 20px; font-size: 22px; background: none transparent; font-weight: bold; } #ncms_inline-editor .ncms-close-editor:hover {background: none; color: #fff; } #ncms_inline-editor .ncms-close-editor.show {display: block; } #ncms_inline-editor #ncms-create-link {position: relative; width: 500px; } #ncms_inline-editor #ncms-create-link .ncms-close-editor {top: -7px; } #ncms_inline-editor #ncms-create-link button {width: 100px; float: right; } #ncms_inline-editor #ncms-create-link button.ncms_button {margin-right: 10px; } #ncms_inline-editor #ncms-create-link button.ncms_button-cancel {margin-right: 0; } #ncms_inline-editor #ncms-create-link button.ncms_button-cancel:hover {background-color: #96aaaf; } #ncms_inline-editor #ncms-create-link label {margin-bottom: 5px; } #ncms_inline-editor #ncms-create-link input {margin-bottom: 5px; } #ncms_inline-editor #ncms-create-link .clear-text {position: absolute; top: 28px; right: 0; display: block; width: 20px; height: 20px; border-radius: 10px; outline: 0; border: 0; } #ncms_inline-editor #ncms-create-link .clear-url {position: absolute; bottom: 7px; right: 10px; width: 20px; height: 20px; border-radius: 10px; } #ncms_inline-editor button {float: left; width: 135px; height: 35px; font-weight: normal; margin-right: 10px; font-size: 14px; border: 0; outline: 0; background: #5a666a; color: #a6b8bc; border-radius: 5px; } #ncms_inline-editor button:hover, #ncms_inline-editor button .active {display: block; background: #1ec36c; color: #fff; } #ncms_inline-editor button:last-child {margin-right: 0; } #ncms_inline-editor label {text-transform: uppercase; font-size: 14px; } #ncms_inline-editor input {box-sizing: border-box; display: block; height: 34px; background: #263033; padding: 0 0 0 10px; font-size: 14px; color: #fff; border-radius: 5px; border: 1px solid #263033; outline: 0; } #ncms_inline-editor input:focus {border-color: #1ec36c; } #ncms_inline-editor input::-moz-selection {background: #1ec36c; } #ncms_inline-editor input::selection {background: #1ec36c; } #ncmsABSelect {position: relative; z-index: 99999; width: 100%; height: 60px; padding: 0 28px; line-height: 60px; color: #96aaaf; background: #263032; font-family: "Montserrat", sans-serif; font-size: 11px; font-weight: 400; letter-spacing: 0.1175em; text-rendering: optimizeLegibility; -webkit-font-smoothing: subpixel-antialiased; box-sizing: border-box; } #ncmsABSelect .controls {float: right; } #ncmsABSelect .controls span {float: left; text-transform: uppercase; margin-right: 16px; } #ncmsABSelect .controls button {color: #96aaaf; font-size: 12px; padding: 8px 16px; background: none; border: 1px solid #59666b; } #ncmsABSelect .controls button:first-of-type {-webkit-border-top-left-radius: 3px; -webkit-border-bottom-left-radius: 3px; -moz-border-radius-topleft: 3px; -moz-border-radius-bottomleft: 3px; border-top-left-radius: 3px; border-bottom-left-radius: 3px; } #ncmsABSelect .controls button:last-of-type {-webkit-border-top-right-radius: 3px; -webkit-border-bottom-right-radius: 3px; -moz-border-radius-topright: 3px; -moz-border-radius-bottomright: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; } #ncmsABSelect .controls button.active {color: #fff; background: #58666c; }';

    var options = {
        siteType: 'html',
        customCSS: css,
        defaultWhiteBackground: true,
        windowSize: {
            width: 1100,
            height: 600
        },
        userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.71 Safari/537.36'
    };

    webshot( req.body.html, null, options, function ( err, stream ) {
        var generateRandomNumber = function () { return Math.floor((Math.random() * 10000000) + 1); };

        var s3 = new AWS.S3({ params: { Bucket: 'spackle-ss-uploads', Key: 'Spackle-Shot_' + generateRandomNumber() + '.png'  } });

        var readableStream = new Readable().wrap(stream);

        s3.upload({ Body: readableStream }, function(err, data) {
            if(err) return console.log(err);

            res.send( { data: data.Location } );
            res.end();
        });
    });

});

http.createServer( app ).listen( process.env.PORT || 1337 );